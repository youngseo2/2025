# app.py
# ì‹¤í–‰: streamlit run app.py
import streamlit as st
import pandas as pd
import random
import hashlib
from datetime import datetime, date

st.set_page_config(page_title="ì•„ì¹¨ ê³µë¶€ ëª…ì–¸ ì¶”ì²œ", page_icon="ğŸ“š", layout="centered")

# -------------------------------
# ë°ì´í„°: ì¹´í…Œê³ ë¦¬ë³„ ê³µë¶€ ëª…ì–¸ (ko)
# -------------------------------
QUOTES = {
    "ë™ê¸°ë¶€ì—¬": [
        "ì‹œì‘ì´ ë°˜ì´ë‹¤. ì§€ê¸ˆ 1ë¶„ì„ ì¡ìœ¼ë©´ í•˜ë£¨ê°€ ë‹¬ë¼ì§„ë‹¤. â€” ì•„ë¦¬ìŠ¤í† í…”ë ˆìŠ¤",
        "ì™„ë²½ë³´ë‹¤ ì™„ìˆ˜ê°€ ë‚«ë‹¤. ì˜¤ëŠ˜ì˜ ì‘ì€ ì™„ìˆ˜ê°€ ë‚´ì¼ì˜ í° ìì‹ ê°ì´ ëœë‹¤.",
        "ì„±ê³µì€ ì—´ì‹¬íˆ ì¤€ë¹„í•œ ì‚¬ëŒì´ ê¸°íšŒì™€ ë§Œë‚¬ì„ ë•Œ ì˜¨ë‹¤. â€” ì„¸ë„¤ì¹´",
        "ì²œì¬ì˜ 1% ì˜ê°ë³´ë‹¤ 99% ë…¸ë ¥. â€” ì—ë””ìŠ¨",
        "ì˜¤ëŠ˜ì˜ ë…¸ë ¥ì´ ë‚´ì¼ì˜ ë„ˆë¥¼ ë§Œë“ ë‹¤.",
        "ì§€ê¸ˆì˜ ë¶ˆí¸í•¨ì€ ì„±ì¥ì˜ ì˜ìˆ˜ì¦ì´ë‹¤.",
        "í¬ê¸°í•˜ê³  ì‹¶ì„ ë•Œê°€ ëì´ ì•„ë‹ˆë¼, ì§„ì§œ ì‹œì‘ì ì´ë‹¤.",
        "ì‘ê²Œë¼ë„ ì›€ì§ì—¬ë¼. ê´€ì„±ì€ ì›€ì§ì„ ì†ì—ì„œ ìƒê¸´ë‹¤."
    ],
    "ì§‘ì¤‘": [
        "ì¤‘ìš”í•œ ì¼ë¶€í„° í•˜ë¼. ì‚¬ì†Œí•¨ì´ ì§‘ì¤‘ì„ ê°€ì¥ ì˜ í›”ì¹œë‹¤. â€” ìŠ¤í‹°ë¸ ì½”ë¹„",
        "í•œ ë²ˆì— í•˜ë‚˜. ê¹Šê²Œ íŒŒì•¼ ë¬¼ì´ ë‚˜ì˜¨ë‹¤.",
        "ì§‘ì¤‘ì€ â€˜í•˜ì§€ ì•Šì„ ìš©ê¸°â€™ì—ì„œ ì‹œì‘ëœë‹¤.",
        "ë°©í•´ë¥¼ ì¤„ì´ë©´ ì‹¤ë ¥ì€ ìì—°íˆ ë“œëŸ¬ë‚œë‹¤.",
        "ëª°ì…ì€ ì¬ëŠ¥ì´ ì•„ë‹ˆë¼ í™˜ê²½ì˜ ê²°ê³¼ë‹¤.",
        "ì˜¤ëŠ˜ í•  3ê°€ì§€ë§Œ ì •í•˜ê³  ëê¹Œì§€ ë°€ì–´ë¼.",
        "ì†ŒìŒì€ ë©€ë¦¬, í˜¸í¡ì€ ê¹Šì´, ì‹œì„ ì€ í•œ ê³³ì—.",
        "ì§‘ì¤‘ì€ ê·¼ìœ¡ì´ë‹¤. ë§¤ì¼ ì¡°ê¸ˆì”© ë‹¨ë ¨í•˜ë¼."
    ],
    "ê¾¸ì¤€í•¨": [
        "ë§¤ì¼ 1%ì˜ ê°œì„ ì´ 1ë…„ í›„ ë„ˆë¥¼ ë°”ê¾¼ë‹¤. â€” ì œì„ìŠ¤ í´ë¦¬ì–´",
        "ì²œì²œíˆ ê°€ë„ ë©ˆì¶”ì§€ ì•Šìœ¼ë©´ ë„ì°©í•œë‹¤. â€” ê³µì",
        "ë£¨í‹´ì€ ì˜ì§€ì˜ ì•„ê»´ ì“°ê¸°ë‹¤.",
        "ì‘ì€ ìŠ¹ë¦¬ë¥¼ ê¸°ë¡í•˜ë¼. ê¸°ë¡ì€ ìŠµê´€ì„ ë§Œë“ ë‹¤.",
        "ì§€ì†ì´ ê³§ ì‹¤ë ¥ì´ë‹¤.",
        "ì˜¤ëŠ˜ë„ ìŒ“ì•˜ë‹¤ë©´ ì„±ê³µí•œ í•˜ë£¨ë‹¤.",
        "ê¾¸ì¤€í•¨ì€ ì¬ëŠ¥ì„ ì´ê¸´ë‹¤.",
        "ì„¸ì›”ì´ íë¥¼ìˆ˜ë¡ ì¤‘ìš”í•œ ê±´ â€˜ì†ë„â€™ê°€ ì•„ë‹ˆë¼ â€˜ì§€ì†â€™ì´ë‹¤."
    ],
    "íšŒë³µ/ë¦¬ì…‹": [
        "ë„˜ì–´ì¡Œë‹¤ë©´ ì¼ì–´ë‚˜ë¼. ì¼ì–´ë‚˜ë©´ ê·¸ê±´ í›ˆë ¨ì´ì—ˆë‹¤.",
        "ì‹¤ìˆ˜ëŠ” ë°ì´í„°ë‹¤. ë‹¤ìŒ ì‹œë„ë¥¼ ë” ë˜‘ë˜‘í•˜ê²Œ ë§Œë“ ë‹¤.",
        "íœ´ì‹ë„ ê³„íšì˜ ì¼ë¶€ë‹¤.",
        "ì–´ì œì˜ ë‚˜ë¥¼ ìš©ì„œí•´ì•¼ ì˜¤ëŠ˜ì˜ ë‚´ê°€ ë‹¬ë¦°ë‹¤.",
        "í•œ ê±¸ìŒ ë¬¼ëŸ¬ì„¬ì´ ë” í° ë„ì•½ì´ ëœë‹¤.",
        "ê´œì°®ë‹¤. ë‹¤ì‹œ ì •ë¦¬í•˜ê³ , ë‹¤ì‹œ ì‹œì‘í•˜ë©´ ëœë‹¤.",
        "ì™„ë²½í•œ í•˜ë£¨ë³´ë‹¤ íšŒë³µ ê°€ëŠ¥í•œ í•˜ë£¨ê°€ ë” ê°•í•˜ë‹¤.",
        "í˜¸í¡ì„ ê³ ë¥´ë©´ ìƒê°ë„ ì •ë¦¬ëœë‹¤."
    ],
    "ìì‹ ê°": [
        "í•  ìˆ˜ ìˆë‹¤ê³  ë¯¿ëŠ” ìˆœê°„, ë°˜ì€ ì´ë£¨ì—ˆë‹¤. â€” ì‹œì–´ë„ì–´ ë£¨ìŠ¤ë²¨íŠ¸",
        "ë¹„êµëŠ” ìì‹ ê°ì„ í›”ì¹œë‹¤. ì–´ì œì˜ ë‚˜ì™€ë§Œ ê²¨ë¤„ë¼.",
        "ì‘ì€ ì„±ê³µì„ í¬ê²Œ ì¹­ì°¬í•˜ë¼. ë‡ŒëŠ” ë³´ìƒì„ ê¸°ì–µí•œë‹¤.",
        "ë‚˜ëŠ” ì¶©ë¶„íˆ í•´ë‚¼ ìˆ˜ ìˆë‹¤.",
        "ë‘ë ¤ì›€ì€ ìƒìƒì´ê³ , ê°€ëŠ¥ì„±ì€ ì‚¬ì‹¤ì´ë‹¤.",
        "ìì‹ ê°ì€ ê²°ê³¼ê°€ ì•„ë‹ˆë¼ ì„ íƒì´ë‹¤.",
        "ëª¨ë¥´ëŠ” ê±´ ì•½ì ì´ ì•„ë‹ˆë¼ ì‹œì‘ì ì´ë‹¤.",
        "ìŠ¤ìŠ¤ë¡œë¥¼ ì‘ì›í•˜ëŠ” ë²•ì„ ë°°ìš°ì."
    ],
    "ë¶ˆì•ˆ/ìŠ¤íŠ¸ë ˆìŠ¤": [
        "ë¶ˆì•ˆì€ ì¤€ë¹„ë¡œ ì¤„ì¼ ìˆ˜ ìˆë‹¤. 25ë¶„ë§Œ ì§‘ì¤‘í•´ì„œ ì‹œì‘í•˜ë¼.",
        "ì™„ë²½í•œ ê³„íšë³´ë‹¤ ì§€ê¸ˆì˜ ì²« ì¤„ì´ ë‚«ë‹¤.",
        "í˜¸í¡ 4Â·7Â·8, ê·¸ë¦¬ê³  ì²« ë¬¸ì œ í•œ ê°œ.",
        "í•´ì•¼ í•  ê²ƒë³´ë‹¤ í•  ìˆ˜ ìˆëŠ” ê²ƒë¶€í„°.",
        "ì¼ë‹¨ ìë¦¬ì— ì•‰ëŠ” ê²ƒì´ ì ˆë°˜ì´ë‹¤.",
        "í•  ì¼ì„ ìª¼ê°œë©´ ê±±ì •ë„ ìª¼ê°œì§„ë‹¤.",
        "ë¶ˆì•ˆì€ â€˜ë¯¸ì§€â€™ì—ì„œ ì˜¤ë‹ˆ, â€˜ì‹œì‘â€™ìœ¼ë¡œ ì¤„ì—¬ë¼.",
        "ê¸´ì¥ì€ ì‹¤ë ¥ì„ êº¼ë‚´ëŠ” ìŠ¤ìœ„ì¹˜ë‹¤."
    ],
    "ìŠ¬ëŸ¼í”„/ê¶Œíƒœ": [
        "ìƒˆë¡œìš´ ì…ë ¥ì´ ìƒˆë¡œìš´ ì¶œë ¥ì„ ë§Œë“ ë‹¤. ê³µë¶€ ì¥ì†Œë¥¼ ë°”ê¿”ë³´ì.",
        "ì‘ì€ ë„ì „ í•˜ë‚˜. ë¬¸ì œ ë‚œì´ë„ë¥¼ ë°˜ ë‹¨ê³„ë§Œ ì˜¬ë ¤ë¼.",
        "ê¶ŒíƒœëŠ” ì‹ í˜¸ë‹¤. ë°©ë²•ì„ ë°”ê¿”ë³´ë¼ëŠ”.",
        "ëª©í‘œë¥¼ ê°ì •ìœ¼ë¡œ ì—°ê²°í•˜ë¼. â€˜ì™œâ€™ê°€ â€˜ì–´ë–»ê²Œâ€™ë¥¼ ì´ëˆë‹¤.",
        "5ë¶„ë§Œ í•˜ì. ê·¸ë¦¬ê³  5ë¶„ì„ í•œ ë²ˆ ë”.",
        "ë£¨í‹´ì— ì¬ë¯¸ í•œ ìŠ¤í‘¼: íƒ€ì´ë¨¸, ì²´í¬ë¦¬ìŠ¤íŠ¸, ë³´ìƒ.",
        "ì™„ë²½íˆ ì¬ì¶©ì „í•œ ë’¤ ë‹¤ì‹œ ë‹¬ë ¤ë„ ëŠ¦ì§€ ì•Šë‹¤.",
        "ìŠ¬ëŸ¼í”„ëŠ” ê¸°ë¡ì˜ ì¼ë¶€ì´ì§€ ê²°ë¡ ì´ ì•„ë‹ˆë‹¤."
    ]
}

# -------------------------------
# ë§¤í•‘: ê¸°ë¶„/ìƒíƒœ â†’ ì¶”ì²œ ì¹´í…Œê³ ë¦¬ ê°€ì¤‘ì¹˜
# -------------------------------
MOODS = ["ğŸ˜Š ìƒì¾Œí•¨", "ğŸ™‚ í‰ì˜¨í•¨", "ğŸ˜ ë³´í†µ", "ğŸ˜µ í”¼ê³¤í•¨", "ğŸ˜Ÿ ë¶ˆì•ˆ/ê±±ì •", "ğŸ¥± ì˜ìš•ì €í•˜", "ğŸ˜• ì‚°ë§Œí•¨", "ğŸ¤© ì˜ìš•ì¶©ë§Œ"]
STATES = ["ì˜ ì¤ë‹¤", "ìˆ˜ë©´ë¶€ì¡±", "ìŠ¤íŠ¸ë ˆìŠ¤ ë§ìŒ", "í•  ì¼ ë§ìŒ", "ì—¬ìœ  ìˆìŒ", "ì‹œí—˜/í‰ê°€ ì„ë°•", "ìŠ¬ëŸ¼í”„ ëŠë‚Œ"]

PREFERENCES = {
    "ğŸ˜Š ìƒì¾Œí•¨": {"ê¾¸ì¤€í•¨": 3, "ì§‘ì¤‘": 3, "ë™ê¸°ë¶€ì—¬": 2, "ìì‹ ê°": 2},
    "ğŸ™‚ í‰ì˜¨í•¨": {"ì§‘ì¤‘": 3, "ê¾¸ì¤€í•¨": 3, "ë™ê¸°ë¶€ì—¬": 2},
    "ğŸ˜ ë³´í†µ": {"ì§‘ì¤‘": 2, "ê¾¸ì¤€í•¨": 2, "ë™ê¸°ë¶€ì—¬": 2, "ìì‹ ê°": 1},
    "ğŸ˜µ í”¼ê³¤í•¨": {"íšŒë³µ/ë¦¬ì…‹": 4, "ê¾¸ì¤€í•¨": 2, "ì§‘ì¤‘": 1},
    "ğŸ˜Ÿ ë¶ˆì•ˆ/ê±±ì •": {"ë¶ˆì•ˆ/ìŠ¤íŠ¸ë ˆìŠ¤": 4, "ìì‹ ê°": 2, "ì§‘ì¤‘": 1},
    "ğŸ¥± ì˜ìš•ì €í•˜": {"ìŠ¬ëŸ¼í”„/ê¶Œíƒœ": 4, "ë™ê¸°ë¶€ì—¬": 3, "ìì‹ ê°": 1},
    "ğŸ˜• ì‚°ë§Œí•¨": {"ì§‘ì¤‘": 4, "ë¶ˆì•ˆ/ìŠ¤íŠ¸ë ˆìŠ¤": 2},
    "ğŸ¤© ì˜ìš•ì¶©ë§Œ": {"ë™ê¸°ë¶€ì—¬": 4, "ì§‘ì¤‘": 2, "ê¾¸ì¤€í•¨": 2, "ìì‹ ê°": 2},
}

STATE_BOOSTS = {
    "ì˜ ì¤ë‹¤": {"ì§‘ì¤‘": 2, "ê¾¸ì¤€í•¨": 1},
    "ìˆ˜ë©´ë¶€ì¡±": {"íšŒë³µ/ë¦¬ì…‹": 3, "ì§‘ì¤‘": -1},
    "ìŠ¤íŠ¸ë ˆìŠ¤ ë§ìŒ": {"ë¶ˆì•ˆ/ìŠ¤íŠ¸ë ˆìŠ¤": 3, "íšŒë³µ/ë¦¬ì…‹": 1},
    "í•  ì¼ ë§ìŒ": {"ì§‘ì¤‘": 3, "ê¾¸ì¤€í•¨": 1},
    "ì—¬ìœ  ìˆìŒ": {"ê¾¸ì¤€í•¨": 2, "ë™ê¸°ë¶€ì—¬": 1},
    "ì‹œí—˜/í‰ê°€ ì„ë°•": {"ì§‘ì¤‘": 3, "ìì‹ ê°": 2, "ë¶ˆì•ˆ/ìŠ¤íŠ¸ë ˆìŠ¤": 1},
    "ìŠ¬ëŸ¼í”„ ëŠë‚Œ": {"ìŠ¬ëŸ¼í”„/ê¶Œíƒœ": 3, "ë™ê¸°ë¶€ì—¬": 2}
}

GOALS = ["ê°œë…í•™ìŠµ", "ë¬¸ì œí’€ì´/ì‹¤ì „", "ë³µìŠµ/ì •ë¦¬", "ì•”ê¸°", "ëª¨ì˜ê³ ì‚¬ ëŒ€ë¹„", "í”„ë¡œì íŠ¸/ë¦¬í¬íŠ¸"]

GOAL_TWEAKS = {
    "ê°œë…í•™ìŠµ": {"ì§‘ì¤‘": 1},
    "ë¬¸ì œí’€ì´/ì‹¤ì „": {"ì§‘ì¤‘": 1, "ìì‹ ê°": 1},
    "ë³µìŠµ/ì •ë¦¬": {"ê¾¸ì¤€í•¨": 1},
    "ì•”ê¸°": {"ì§‘ì¤‘": 1},
    "ëª¨ì˜ê³ ì‚¬ ëŒ€ë¹„": {"ë¶ˆì•ˆ/ìŠ¤íŠ¸ë ˆìŠ¤": 1, "ìì‹ ê°": 1},
    "í”„ë¡œì íŠ¸/ë¦¬í¬íŠ¸": {"ì§‘ì¤‘": 1, "ë™ê¸°ë¶€ì—¬": 1}
}

# -------------------------------
# ìœ í‹¸ë¦¬í‹°
# -------------------------------
def weighted_categories(mood, state, goal):
    weights = {}
    for k, v in PREFERENCES.get(mood, {}).items():
        weights[k] = weights.get(k, 0) + v
    for k, v in STATE_BOOSTS.get(state, {}).items():
        weights[k] = weights.get(k, 0) + v
    for k, v in GOAL_TWEAKS.get(goal, {}).items():
        weights[k] = weights.get(k, 0) + v

    # ìŒìˆ˜ ë°©ì§€ ë° ìµœì†Œ ê°€ì¤‘ì¹˜ ë³´ì •
    for cat in QUOTES.keys():
        weights[cat] = max(0, weights.get(cat, 0))
    total = sum(weights.values())
    if total == 0:
        # ì „ë¶€ 0ì´ë©´ ê¸°ë³¸ ê°€ì¤‘ì¹˜
        for cat in QUOTES.keys():
            weights[cat] = 1
    return weights

def deterministic_choice(options, seed_str):
    """seed_str(ë¬¸ìì—´)ì„ í•´ì‹œë¡œ ë³€í™˜í•˜ì—¬ í•˜ë£¨ ê³ ì • ì¶”ì²œ ìƒì„±"""
    h = hashlib.sha256(seed_str.encode()).hexdigest()
    idx = int(h, 16) % len(options)
    return options[idx]

def pick_quote(mood, state, goal, stable=True, exclude=None):
    weights = weighted_categories(mood, state, goal)
    cats = list(weights.keys())
    # ì•ˆì • ëª¨ë“œ: ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ë°˜ìœ¼ë¡œ ê³ ì •
    if stable:
        today = date.today().isoformat()
        # ì¹´í…Œê³ ë¦¬ ì„ íƒ
        weighted_list = []
        for c in cats:
            weighted_list += [c] * max(1, weights[c])
        cat = deterministic_choice(weighted_list, f"{today}|{mood}|{state}|{goal}|cat")
        # ëª…ì–¸ ì„ íƒ
        candidates = QUOTES[cat]
        if exclude:
            candidates = [q for q in candidates if q not in exclude] or QUOTES[cat]
        quote = deterministic_choice(candidates, f"{today}|{mood}|{state}|{goal}|quote")
        return cat, quote
    else:
        # ë¹„ì•ˆì • ëª¨ë“œ: ê°€ì¤‘ ë¬´ì‘ìœ„
        population = []
        for c, w in weights.items():
            population += [c] * max(1, w)
        cat = random.choice(population)
        candidates = QUOTES[cat]
        if exclude:
            candidates = [q for q in candidates if q not in exclude] or QUOTES[cat]
        quote = random.choice(candidates)
        return cat, quote

def init_state():
    if "logs" not in st.session_state:
        st.session_state["logs"] = []  # [{date, mood, state, goal, quote, category, memo}]
    if "last_quote" not in st.session_state:
        st.session_state["last_quote"] = None
    if "today_fixed" not in st.session_state:
        st.session_state["today_fixed"] = None

init_state()

# -------------------------------
# UI
# -------------------------------
st.title("ğŸ“š ì•„ì¹¨ ê³µë¶€ ëª…ì–¸ ì¶”ì²œ")
st.caption("ë§¤ì¼ ì•„ì¹¨ ê¸°ë¶„ê³¼ ìƒíƒœì— ë§ì¶° ë”± ë§ëŠ” í•œ ì¤„. ê¾¸ì¤€í•¨ì€ ê²°êµ­ ì‹¤ë ¥ì´ ë©ë‹ˆë‹¤ ğŸ™‚")

col1, col2 = st.columns(2)
with col1:
    mood = st.selectbox("ì˜¤ëŠ˜ ê¸°ë¶„", MOODS, index=0)
with col2:
    state = st.selectbox("í˜„ì¬ ìƒíƒœ", STATES, index=0)

goal = st.radio("ì˜¤ëŠ˜ ê³µë¶€ ëª©í‘œ", GOALS, horizontal=True, index=1)

st.divider()

# ì˜¤ëŠ˜ì˜ ê³ ì • ì¶”ì²œ ìƒì„± & í‘œì‹œ
if st.session_state["today_fixed"] is None:
    cat, q = pick_quote(mood, state, goal, stable=True)
    st.session_state["today_fixed"] = {"category": cat, "quote": q}

fixed = st.session_state["today_fixed"]
st.subheader("ğŸŒ¤ï¸ ì˜¤ëŠ˜ì˜ ëª…ì–¸")
st.markdown(f"> **[{fixed['category']}]** {fixed['quote']}")

colA, colB, colC = st.columns([1,1,1])
with colA:
    if st.button("ğŸ“‹ ëª…ì–¸ ë³µì‚¬"):
        st.toast("í´ë¦½ë³´ë“œë¡œ ë³µì‚¬í–ˆìŠµë‹ˆë‹¤! (ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ ë³µì‚¬í•´ ì£¼ì„¸ìš”.)")
with colB:
    # ì˜¤ëŠ˜ì˜ ê³ ì •ì€ ìœ ì§€, ë‹¤ë¥¸ í›„ë³´ ë³´ê¸°
    if st.button("ğŸ² ë‹¤ë¥¸ í›„ë³´ ë³´ê¸°"):
        cat2, q2 = pick_quote(mood, state, goal, stable=False, exclude={fixed["quote"]})
        st.session_state["last_quote"] = {"category": cat2, "quote": q2}
with colC:
    if st.button("ğŸ”„ ê¸°ë¶„/ìƒíƒœ ë°˜ì˜í•´ ì˜¤ëŠ˜ ëª…ì–¸ ë‹¤ì‹œ ê³ ì •"):
        cat_new, q_new = pick_quote(mood, state, goal, stable=True)
        st.session_state["today_fixed"] = {"category": cat_new, "quote": q_new}
        st.session_state["last_quote"] = None
        st.success("ì˜¤ëŠ˜ì˜ ëª…ì–¸ì„ í˜„ì¬ ì„ íƒì— ë§ì¶° ìƒˆë¡œ ê³ ì •í–ˆì–´ìš”!")

if st.session_state["last_quote"]:
    st.write("**ë˜ ë‹¤ë¥¸ ì¶”ì²œ**")
    st.markdown(f"> [{st.session_state['last_quote']['category']}] {st.session_state['last_quote']['quote']}")

st.divider()

# ë©”ëª¨ ë° ê¸°ë¡ ì €ì¥
memo = st.text_area("ì˜¤ëŠ˜ì˜ í•œ ì¤„ ë‹¤ì§/ë©”ëª¨", placeholder="ì˜ˆ) ì˜¤ëŠ˜ì€ ì˜¤ë‹µë…¸íŠ¸ 30ë¶„ + ìˆ˜í•™ Nì œ 20ë¬¸ì œ")
save_col1, save_col2 = st.columns([1,1])
with save_col1:
    if st.button("ğŸ“ ì˜¤ëŠ˜ ê¸°ë¡ ì €ì¥"):
        today_str = datetime.now().strftime("%Y-%m-%d %H:%M")
        entry = {
            "datetime": today_str,
            "mood": mood,
            "state": state,
            "goal": goal,
            "category": st.session_state["today_fixed"]["category"],
            "quote": st.session_state["today_fixed"]["quote"],
            "memo": memo.strip()
        }
        st.session_state["logs"].append(entry)
        st.success("ê¸°ë¡ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!")
with save_col2:
    if st.button("ğŸ§¹ ì…ë ¥ ì´ˆê¸°í™”"):
        st.session_state["last_quote"] = None
        st.experimental_rerun()

# ê¸°ë¡ í…Œì´ë¸” & ë‹¤ìš´ë¡œë“œ
st.divider()
st.subheader("ğŸ“’ ë‚˜ì˜ ê¸°ë¡")
if st.session_state["logs"]:
    df = pd.DataFrame(st.session_state["logs"])
    st.dataframe(df, use_container_width=True, hide_index=True)
    csv = df.to_csv(index=False).encode("utf-8-sig")
    st.download_button("â¬‡ï¸ CSVë¡œ ë‹¤ìš´ë¡œë“œ", data=csv, file_name="study_quotes_logs.csv", mime="text/csv")
else:
    st.info("ì•„ì§ ì €ì¥ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤. â€˜ì˜¤ëŠ˜ ê¸°ë¡ ì €ì¥â€™ì„ ëˆŒëŸ¬ë³´ì„¸ìš”!")

# í’‹í„°
st.caption("Tip) â€˜ì˜¤ëŠ˜ì˜ ëª…ì–¸â€™ì€ ë‚ ì§œÂ·ê¸°ë¶„Â·ìƒíƒœÂ·ëª©í‘œ ì¡°í•©ìœ¼ë¡œ í•˜ë£¨ ë™ì•ˆ ê³ ì •ë©ë‹ˆë‹¤. \
ë‹¤ë¥¸ í›„ë³´ë¥¼ ë³´ê³  ì‹¶ìœ¼ë©´ â€˜ë‹¤ë¥¸ í›„ë³´ ë³´ê¸°â€™ë¥¼ ëˆŒëŸ¬ë³´ì„¸ìš”.")

