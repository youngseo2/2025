import streamlit as st
import datetime

st.title("ğŸ“š ê³µë¶€ ë„ìš°ë¯¸")

# -------------------------
# ì˜¤ëŠ˜ ë‚ ì§œ
# -------------------------
today = str(datetime.date.today())

if "diary" not in st.session_state:
    st.session_state.diary = {}

if "tasks" not in st.session_state:
    st.session_state.tasks = {}

if today not in st.session_state.tasks:
    st.session_state.tasks[today] = []

# -------------------------
# ëª…ì–¸ ì¶”ì²œ
# -------------------------
moods = ["ğŸ˜Š ì¢‹ìŒ", "ğŸ˜ ê·¸ëƒ¥ì €ëƒ¥", "ğŸ˜Ÿ ë³„ë¡œì„"]
states = ["ğŸ’ª ì—ë„ˆì§€ ì¶©ë¶„", "ğŸ˜´ í”¼ê³¤í•¨", "ğŸ¤¯ ìŠ¤íŠ¸ë ˆìŠ¤"]

mood = st.selectbox("ì˜¤ëŠ˜ ê¸°ë¶„ì€?", moods)
state = st.selectbox("í˜„ì¬ ìƒíƒœëŠ”?", states)

quotes = {
    ("ğŸ˜Š ì¢‹ìŒ", "ğŸ’ª ì—ë„ˆì§€ ì¶©ë¶„"): "ì˜¤ëŠ˜ì˜ ì—´ì •ì´ ë‚´ì¼ì˜ ì„±ê³µì„ ë§Œë“ ë‹¤.",
    ("ğŸ˜Š ì¢‹ìŒ", "ğŸ˜´ í”¼ê³¤í•¨"): "ì‰¬ì–´ê°€ë„ ê´œì°®ì•„, ê¾¸ì¤€í•¨ì´ ì¤‘ìš”í•˜ë‹¤.",
    ("ğŸ˜Š ì¢‹ìŒ", "ğŸ¤¯ ìŠ¤íŠ¸ë ˆìŠ¤"): "ì›ƒìŒì€ ìµœê³ ì˜ ìŠ¤íŠ¸ë ˆìŠ¤ í•´ì†Œì œë‹¤.",
    ("ğŸ˜ ê·¸ëƒ¥ì €ëƒ¥", "ğŸ’ª ì—ë„ˆì§€ ì¶©ë¶„"): "ì‘ì€ ì„±ì·¨ê°€ í° ë³€í™”ë¥¼ ë§Œë“ ë‹¤.",
    ("ğŸ˜ ê·¸ëƒ¥ì €ëƒ¥", "ğŸ˜´ í”¼ê³¤í•¨"): "ì¡°ê¸ˆì”©ì´ë¼ë„ í•´ë‚´ëŠ” ê²Œ ì¤‘ìš”í•˜ë‹¤.",
    ("ğŸ˜ ê·¸ëƒ¥ì €ëƒ¥", "ğŸ¤¯ ìŠ¤íŠ¸ë ˆìŠ¤"): "ë§ˆìŒì˜ ì—¬ìœ ê°€ í˜ì´ ëœë‹¤.",
    ("ğŸ˜Ÿ ë³„ë¡œì„", "ğŸ’ª ì—ë„ˆì§€ ì¶©ë¶„"): "í˜ë“  ë‚ ë„ ê²°êµ­ ì§€ë‚˜ê°„ë‹¤.",
    ("ğŸ˜Ÿ ë³„ë¡œì„", "ğŸ˜´ í”¼ê³¤í•¨"): "ì˜¤ëŠ˜ì€ ì‰¬ì–´ë„ ê´œì°®ë‹¤.",
    ("ğŸ˜Ÿ ë³„ë¡œì„", "ğŸ¤¯ ìŠ¤íŠ¸ë ˆìŠ¤"): "í¬ê¸°í•˜ì§€ ì•ŠëŠ” ê²ƒì´ ê°€ì¥ í° ìš©ê¸°ë‹¤."
}

if st.button("âœ¨ ì˜¤ëŠ˜ì˜ ëª…ì–¸ ë³´ê¸°"):
    st.success(quotes.get((mood, state), "ê¾¸ì¤€í•¨ì´ ê²°êµ­ ì¬ëŠ¥ì„ ì´ê¸´ë‹¤."))

# -------------------------
# í•  ì¼ ì²´í¬ë¦¬ìŠ¤íŠ¸
# -------------------------
st.header("ğŸ“ ì˜¤ëŠ˜ì˜ í•  ì¼")

new_task = st.text_input("í•  ì¼ì„ ì…ë ¥í•˜ì„¸ìš”:")

if st.button("ì¶”ê°€í•˜ê¸°"):
    if new_task.strip():
        st.session_state.tasks[today].append({"task": new_task, "done": False})

for i, t in enumerate(st.session_state.tasks[today]):
    checked = st.checkbox(t["task"], value=t["done"], key=f"{today}_task_{i}")
    st.session_state.tasks[today][i]["done"] = checked

if st.button("âœ… ì™„ë£Œí•œ í•­ëª© ì§€ìš°ê¸°"):
    st.session_state.tasks[today] = [t for t in st.session_state.tasks[today] if not t["done"]]

# -------------------------
# ì˜¤ëŠ˜ì˜ ì¼ê¸° / ë©”ëª¨
# -------------------------
st.header("ğŸ“– ì˜¤ëŠ˜ì˜ ë©”ëª¨")

diary_text = st.text_area("ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ ê¸°ë¡í•˜ì„¸ìš”:", st.session_state.diary.get(today, ""))

# ğŸŸ¢ í‚¤ì›Œë“œ â†’ ì´ëª¨ì§€ ë§¤í•‘
emoji_map = {
    # ìŒì‹
    "ë°¥": "ğŸš", "ë¼ë©´": "ğŸœ", "ê¹€ì¹˜": "ğŸ¥¬", "ê³ ê¸°": "ğŸ–", "ì¹˜í‚¨": "ğŸ—",
    "í”¼ì": "ğŸ•", "í–„ë²„ê±°": "ğŸ”", "ë–¡ë³¶ì´": "ğŸ¢", "ê³¼ì¼": "ğŸ", "ì¼€ì´í¬": "ğŸ°",
    "ì»¤í”¼": "â˜•", "ìŒë£Œ": "ğŸ¥¤",

    # í™œë™/í•˜ë£¨ ì¼ê³¼
    "ê³µë¶€": "ğŸ“–", "ì‹œí—˜": "âœï¸", "í•™êµ": "ğŸ«", "ìš´ë™": "ğŸƒ", "ì¶•êµ¬": "âš½",
    "ê²Œì„": "ğŸ®", "ì˜í™”": "ğŸ¬", "ì‚°ì±…": "ğŸš¶", "ì—¬í–‰": "âœˆï¸", "ì‡¼í•‘": "ğŸ›ï¸",

    # ê°ì •/ìƒíƒœ
    "í–‰ë³µ": "ğŸ˜„", "ê¸°ë¶„": "ğŸ™‚", "ìŠ¬í””": "ğŸ˜¢", "í”¼ê³¤": "ğŸ¥±", "ìŠ¤íŠ¸ë ˆìŠ¤": "ğŸ˜µ",
    "ì¬ë°Œ": "ğŸ˜‚", "í™”ë‚¨": "ğŸ˜¡", "ë†€ëŒ": "ğŸ˜²"
}

def add_emojis(text: str) -> str:
    result = text
    for word, emoji in emoji_map.items():
        if word in result:
            result = result.replace(word, f"{word}{emoji}")
    return result

if st.button("ğŸ’¾ ë©”ëª¨ ì €ì¥"):
    st.session_state.diary[today] = diary_text
    st.success("ì˜¤ëŠ˜ì˜ ë©”ëª¨ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤ âœ…")

# ì €ì¥ëœ ë©”ëª¨ ì¶œë ¥ (ì´ëª¨í‹°ì½˜ ë³€í™˜)
if today in st.session_state.diary:
    st.subheader("ğŸ“Œ ì˜¤ëŠ˜ ê¸°ë¡ ë³´ê¸°")
    st.write(add_emojis(st.session_state.diary[today]))
